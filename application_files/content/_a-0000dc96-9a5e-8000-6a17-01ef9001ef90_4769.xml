<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<contentHaul xmlns:a="http://www.appian.com/ae/types/2009">
    <versionUuid>_a-0000e0b7-c14e-8000-10cb-01ef9001ef90_30341</versionUuid>
    <rule>
        <name>CASE_APP_uiSectionPaymentInfo</name>
        <uuid>_a-0000dc96-9a5e-8000-6a17-01ef9001ef90_4769</uuid>
        <description>Allows to capture payment information and validate it</description>
        <parentUuid>_a-0000d9c4-bcac-8000-9ba2-011c48011c48_5995</parentUuid>
        <visibility>
            <advertise>false</advertise>
            <hierarchy>true</hierarchy>
            <indexable>true</indexable>
            <quota>false</quota>
            <searchable>true</searchable>
            <system>false</system>
            <unlogged>false</unlogged>
        </visibility>
        <definition>=load(
  local!paymentInfo,
  local!doValidation: false,
  local!encryptedCard,
  {
    #"SYSTEM_SYSRULES_sectionLayout"(
      label: "Swipe Card",
      firstColumnContents: {
        #"SYSTEM_SYSRULES_paymentInfoField"(
          label: "",
          labelPosition: "COLLAPSED",
          buttonLabel: "Scan Card",
          value: local!paymentInfo,
          saveInto: {
            local!paymentInfo,
            a!save(
              target: ri!ccNumber,
              value: local!paymentInfo.accountNumber
            ),
            a!save(
              target: ri!ccExpDate,
              value: local!paymentInfo.expirationMonth &amp; "/" &amp; local!paymentInfo.expirationYear
            ),
            a!save(
              local!encryptedCard,
              local!paymentInfo.accountNumber
            )
          }
        )
      }
    ),
    #"SYSTEM_SYSRULES_sectionLayout"(
      label: "Payment Information",
      firstColumnContents: {
        #"SYSTEM_SYSRULES_textField"(
          label: "Credit Card Number",
          instructions: "Enter the 15 or 16 digit credit card number.",
          value: #"_a-0000dc96-9a5e-8000-6a17-01ef9001ef90_4770"(ri!ccNumber),
          saveInto: a!save(ri!ccNumber, cleanwith(save!value, "0123456789")),
          refreshAfter: "UNFOCUS",
          required: true(),
          validations: {
            if(
              or(len(ri!ccNumber) = 15, len(ri!ccNumber) = 16),
              null,
              "You must enter either 15 or 16 digits"
            )
          }
        ),
        #"SYSTEM_SYSRULES_textField"(
          label: "Expiration Date",
          instructions: "Enter the expiration date in MM/YY format",
          value: ri!ccExpDate,
          saveInto: a!save(ri!ccExpDate, cleanwith(save!value, "0123456789/")),
          required: true(),
          validations: {
            if(len(ri!ccExpDate) &lt;&gt; 5, "Please enter expiration date in MM/YY format", null),
            if(and(len(ri!ccExpDate) = 5, ri!ccExpDate[3] &lt;&gt; "/"), "Please enter expiration date in MM/YY format", null)
          }
        )
      },
      secondColumnContents: {
        #"SYSTEM_SYSRULES_textField"(
          label: "Card Code",
          instructions: "Enter the credit card verification code",
          value: ri!ccCode,
          saveInto: a!save(ri!ccCode, cleanwith(save!value, "0123456789")),
          required: true()
        ),
        if(
          ri!doCCAuthorization,
          #"SYSTEM_SYSRULES_ButtonLayout"(
            primaryButtons: {
              #"SYSTEM_SYSRULES_ButtonWidget"(
                label: "Validate Payment Info",
                style: "NORMAL",
                disabled: or(isnull(ri!ccNumber),isnull(ri!ccCode), isnull(ri!ccExpDate)),
                saveInto: a!save(local!doValidation, true)
              )
            },
            secondaryButtons: {}
          ),
          {}
        )
      },
      isCollapsible: true()
    ),
    if(
      local!doValidation,
      #"SYSTEM_SYSRULES_sectionLayout"(
        label: "Payment Authorization",
        firstColumnContents: {
          with(
            local!checkCredit: #"_a-0000dc96-9a5e-8000-6a17-01ef9001ef90_4791"(
              totalAmount: ri!orderTotalAmount,
              ccNumber: ri!ccNumber,
              ccExpDate: ri!ccExpDate,
              ccCode: ri!ccCode
            ),
            #"SYSTEM_SYSRULES_richTextDisplayField"(
              label: "",
              labelPosition: "COLLAPSED",
              value: {
                #"SYSTEM_SYSRULES_richTextImage"(image: #"SYSTEM_SYSRULES_documentImage"(
                  document: if(local!checkCredit.transactionResponse.responseCode="1",
                    #"SYSTEM_SYSRULES_iconIndicator"("STATUS_OK"),
                    #"SYSTEM_SYSRULES_iconIndicator"("STATUS_NOTDONE")
                  )
                )),
                #"SYSTEM_SYSRULES_richTextItem"(
                  text: if(
                    local!checkCredit.transactionResponse.responseCode="1",
                    "Credit Card Approved",
                    "Credit Card Not Approved"
                  ),
                  style: "EMPHASIS"
                )
              },
              size: "MEDIUM"
            )
          )
        }
      ),
      {}
    )
  }
)</definition>
        <namedTypedValue>
            <name>ccNumber</name>
            <type>
                <name>string</name>
                <namespace>http://www.w3.org/2001/XMLSchema</namespace>
            </type>
            <value/>
        </namedTypedValue>
        <namedTypedValue>
            <name>ccCode</name>
            <type>
                <name>string</name>
                <namespace>http://www.w3.org/2001/XMLSchema</namespace>
            </type>
            <value/>
        </namedTypedValue>
        <namedTypedValue>
            <name>ccExpDate</name>
            <type>
                <name>string</name>
                <namespace>http://www.w3.org/2001/XMLSchema</namespace>
            </type>
            <value/>
        </namedTypedValue>
        <namedTypedValue>
            <name>orderTotalAmount</name>
            <type>
                <name>string</name>
                <namespace>http://www.w3.org/2001/XMLSchema</namespace>
            </type>
            <value/>
        </namedTypedValue>
        <namedTypedValue>
            <name>doCCAuthorization</name>
            <type>
                <name>boolean</name>
                <namespace>http://www.w3.org/2001/XMLSchema</namespace>
            </type>
        </namedTypedValue>
        <preferredEditor>interface</preferredEditor>
        <offlineEnabled>false</offlineEnabled>
    </rule>
    <roleMap public="true">
        <role inherit="true" allowForAll="false" name="readers">
            <users/>
            <groups/>
        </role>
        <role inherit="true" allowForAll="false" name="authors">
            <users/>
            <groups/>
        </role>
        <role inherit="true" allowForAll="false" name="administrators">
            <users/>
            <groups/>
        </role>
        <role inherit="false" allowForAll="false" name="denyReaders">
            <users/>
            <groups/>
        </role>
        <role inherit="false" allowForAll="false" name="denyAuthors">
            <users/>
            <groups/>
        </role>
        <role inherit="false" allowForAll="false" name="denyAdministrators">
            <users/>
            <groups/>
        </role>
    </roleMap>
    <typedValue>
        <type>
            <name>RuleTestConfig?list</name>
            <namespace>http://www.appian.com/ae/types/2009</namespace>
        </type>
        <value>
            <el>
                <a:name/>
                <a:ruleInputTestConfigs>
                    <a:value xmlns:xsd="http://www.w3.org/2001/XMLSchema" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:type="xsd:string"/>
                    <a:nameRef>ccNumber</a:nameRef>
                    <a:id/>
                </a:ruleInputTestConfigs>
                <a:ruleInputTestConfigs>
                    <a:value xmlns:xsd="http://www.w3.org/2001/XMLSchema" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:type="xsd:string"/>
                    <a:nameRef>ccCode</a:nameRef>
                    <a:id/>
                </a:ruleInputTestConfigs>
                <a:ruleInputTestConfigs>
                    <a:value xmlns:xsd="http://www.w3.org/2001/XMLSchema" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:type="xsd:string"/>
                    <a:nameRef>ccExpDate</a:nameRef>
                    <a:id/>
                </a:ruleInputTestConfigs>
                <a:ruleInputTestConfigs>
                    <a:value xmlns:xsd="http://www.w3.org/2001/XMLSchema" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:type="xsd:string"/>
                    <a:nameRef>orderTotalAmount</a:nameRef>
                    <a:id/>
                </a:ruleInputTestConfigs>
                <a:ruleInputTestConfigs>
                    <a:value xmlns:xsd="http://www.w3.org/2001/XMLSchema" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:nil="true" xsi:type="xsd:boolean"/>
                    <a:nameRef>doCCAuthorization</a:nameRef>
                    <a:id/>
                </a:ruleInputTestConfigs>
                <a:assertions xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:nil="true"/>
            </el>
        </value>
    </typedValue>
    <history>
        <historyInfo versionUuid="_a-0000e0b7-c14e-8000-10cb-01ef9001ef90_30341"/>
    </history>
</contentHaul>
