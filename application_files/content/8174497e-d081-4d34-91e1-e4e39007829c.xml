<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<contentHaul xmlns:a="http://www.appian.com/ae/types/2009">
    <versionUuid>_a-0000e0b7-c14e-8000-10cb-01ef9001ef90_30039</versionUuid>
    <rule>
        <name>CASE_APP_AvgPricePerCategory</name>
        <uuid>8174497e-d081-4d34-91e1-e4e39007829c</uuid>
        <description>Shows the average price of a product by each category</description>
        <parentUuid>_a-0000d9c4-bcac-8000-9ba2-011c48011c48_5845</parentUuid>
        <visibility>
            <advertise>false</advertise>
            <hierarchy>true</hierarchy>
            <indexable>true</indexable>
            <quota>false</quota>
            <searchable>true</searchable>
            <system>false</system>
            <unlogged>false</unlogged>
        </visibility>
        <definition>load(
  local!pagingInfo: #"SYSTEM_SYSRULES_pagingInfo"(
    startIndex: 1,
    batchSize: -1,
    sort: #"SYSTEM_SYSRULES_sortInfo"(
      field: "price",
      ascending: false
    )
  ),
  local!gridPagingInfo:#"SYSTEM_SYSRULES_pagingInfo"(
    startIndex: 1,
    batchSize: 5,
    sort: #"SYSTEM_SYSRULES_sortInfo"(
      field: "price",
      ascending: false
    )
  ),
  local!selectedCategory,
  with(
    local!datasubset: queryrecord(
      #"_a-0000d9c4-bcac-8000-9ba2-011c48011c48_3830",
      #"SYSTEM_SYSRULES_query"(
        aggregation: #"SYSTEM_SYSRULES_queryAggregation"(aggregationColumns: {
          #"SYSTEM_SYSRULES_queryAggregationColumn"(field: "productCategory", isGrouping: true),
          #"SYSTEM_SYSRULES_queryAggregationColumn"(field: "price", aggregationFunction: "AVG"),
        }),
        pagingInfo: local!pagingInfo
      )
    ),
    if(
      isnull(local!selectedCategory),
      #"SYSTEM_SYSRULES_columnChartField"(
        label: "Average Product Price by Category",
        categories: {
          index(local!datasubset.data, "productCategory", {})
        },
        series: {
          #"SYSTEM_SYSRULES_chartSeries"(
            label: "Price (in $)",
            data: fixed(index(local!datasubset.data, "price", {})),
            links:apply(
              #"SYSTEM_SYSRULES_dynamicLink"(value:_,saveInto:local!selectedCategory),
              index(local!datasubset.data, "productCategory",null)
            )
          )
        }
      ),
      with(
        local!gridDatasubset:queryrecord(
          #"_a-0000d9c4-bcac-8000-9ba2-011c48011c48_3830",
          #"SYSTEM_SYSRULES_query"(
            selection:#"SYSTEM_SYSRULES_querySelection"(
              columns:{
                #"SYSTEM_SYSRULES_queryColumn"(field:"name"),
                #"SYSTEM_SYSRULES_queryColumn"(field:"sku"),
                #"SYSTEM_SYSRULES_queryColumn"(field:"price")
              }
            ),
            filter:#"SYSTEM_SYSRULES_queryFilter"("productCategory","=",local!selectedCategory),
            pagingInfo: local!gridPagingInfo
          )
        ),
        {
          #"SYSTEM_SYSRULES_ButtonLayout"(
            secondaryButtons: #"SYSTEM_SYSRULES_ButtonWidget"(
              label: "Go back",
              value: null,
              saveInto: local!selectedCategory
            )
          ),
          #"SYSTEM_SYSRULES_gridField"(
            label:"Products in "&amp;local!selectedCategory,
            totalCount:local!gridDatasubset.totalCount,
            columns:{
              #"SYSTEM_SYSRULES_gridTextColumn"(
                label:"Name",
                field:"name",
                data:index(local!gridDatasubset.data,"name",null),
                links:apply(
                  #"SYSTEM_SYSRULES_recordLink"(recordType:#"_a-0000d9c4-bcac-8000-9ba2-011c48011c48_3830",identifier:_),
                  local!gridDatasubset.identifiers
                )
              ),
              #"SYSTEM_SYSRULES_gridTextColumn"(
                label:"SKU",
                field:"sku",
                data:index(local!gridDatasubset.data,"sku",null)
                
              ),
              #"SYSTEM_SYSRULES_gridTextColumn"(
                label:"Total Price",
                field:"price",
                data:dollar(index(local!gridDatasubset.data,"price",null)),
                alignment:"RIGHT"
                
              )
            },
            value:local!gridPagingInfo,
            saveInto:local!gridPagingInfo
          )
        }
      )
    )
  )
)
</definition>
        <preferredEditor>interface</preferredEditor>
        <offlineEnabled>false</offlineEnabled>
    </rule>
    <roleMap public="true">
        <role inherit="true" allowForAll="false" name="readers">
            <users/>
            <groups/>
        </role>
        <role inherit="true" allowForAll="false" name="authors">
            <users/>
            <groups/>
        </role>
        <role inherit="true" allowForAll="false" name="administrators">
            <users/>
            <groups/>
        </role>
        <role inherit="false" allowForAll="false" name="denyReaders">
            <users/>
            <groups/>
        </role>
        <role inherit="false" allowForAll="false" name="denyAuthors">
            <users/>
            <groups/>
        </role>
        <role inherit="false" allowForAll="false" name="denyAdministrators">
            <users/>
            <groups/>
        </role>
    </roleMap>
    <history>
        <historyInfo versionUuid="_a-0000e0b7-c14e-8000-10cb-01ef9001ef90_30039"/>
    </history>
</contentHaul>
